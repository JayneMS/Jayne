<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>字段模板设置</title>
        
        <!-- Common plugins -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/simple-line-icons.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/pace.css" rel="stylesheet"><link href="css/jasny-bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/nanoscroller.css">
        <link rel="stylesheet" href="css/metismenu.min.css">
        <!-- dataTables -->
        <link href="css/jquery.datatables.min.css" rel="stylesheet" type="text/css">
        <link href="css/responsive.bootstrap.min.css" rel="stylesheet" type="text/css">
        <!-- Treeview css -->
        <link href="css/style_1.css" rel="stylesheet" type="text/css" />
        <!--template css-->
        <link href="css/style.css" rel="stylesheet">
        <link href="css/jayne.css" rel="stylesheet">
        <!--sweetalert css-->
        <link href="css/sweet-alert.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="js/html5shiv.min.js"></script>
          <script src="js/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>

        <!--modal create-role start-->
        <div class="modal fade" data-backdrop="static" id="createModal" tabindex="-1" role="dialog" aria-labelledby="createModal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times-circle"></span></button>
                        <h3 class="modal-title" id="myModalLabel">选择应用公海</h3>
                    </div>
                    <div class="modal-body">
                        <div class="modal-form">
                            <form role="form">
                                <div class="form-group">
	                                <label>请输入名称</label>
                                    <input type="text" class="field-name" placeholder="">
                                </div>
                                <div class="form-group">
	                                <label>请选择</label>
	                                <select name="" class="form-control" >
	                                	<option value="">移动数据1</option>
	                                	<option value="">移动数据2</option>
	                                </select>
                                </div>
                                <div class="clearfix modal-footer no-border">
                        			<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    <button type="button" class="btn  btn-primary pull-right" onclick="createhighsea()">创建</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--modal create-role end-->

        <!--modal delete-->
        <div class="modal fade modal-delete" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
            <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="mySmallModalLabel">删除数据来源</h4>
                    </div>
                    <div class="modal-body">
                    	您确定要删除此数据来源吗？
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			        	<button class="btn btn-primary" onclick="delete_r(this)" >确定</button>
                        <!--<button type="button" class="btn btn-primary">确定</button>-->
                    </div>
                </div>
            </div>
        </div>
        <!--end delete modal-->
        
        <!--main content start-->
        <section class="main-content">

            <!--page header start-->
            <div class="page-header">
                <div class="row">
                    <div class="col-sm-6 flex-align-center">
                        <h4 class="inline">表字段设置与维护</h4>
                        &nbsp;&nbsp;&nbsp;&nbsp;          
                        <a href="#" id="addRow" class="btn btn-default btn-primary" data-toggle="modal" data-target="#" style="margin:5px;">新建字段</a>
                    </div>
                    <div class="col-sm-6 text-right">
                        <ol class="breadcrumb">
                            <li><a href="javascript: void(0);"><i class="fa fa-home"></i></a></li>
                            <li>系统设置</li>
                            <li>字段模板设置</li>
                        </ol>
                    </div>
                </div>
            </div>
            <!--page header end-->

            <!--start page content-->
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default collapsed">
                        <div class="panel-heading">
                          	字段模板设置
                        </div>
                        <div class="panel-body">
                            <table id="datatable" class="table table-striped dt-responsive nowrap">
                                <thead>
                                    <tr>
                                        <th>字段名称</th>
                                        <th>字段类型</th>
                                        <th>字段关联值</th>
                                        <th>是否必填</th>
                                        <th>是否查询</th>
                                        <th>排序</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                    	<td>套餐类型</td>
                                    	<td>普通文本</td>
                                    	<td>无</td>
                                        <td>是</td>
                                        <td>是</td>
                                        <td>1</td>
                                        <td>
                            				<a href="#" class="" data-toggle="modal" data-target=".modal-delete" style="margin:5px;">删除</a>
                                        </td>
                                    </tr>
                                    <tr>
                                    	<td>手机号码</td>
                                    	<td>电话文本</td>
                                        <td>无</td>
                                        <td>是</td>
                                        <td>是</td>
                                        <td>2</td>
                                        <td>
                            				<a href="#" class="" data-toggle="modal" data-target=".modal-delete" style="margin:5px;">删除</a>
                                        </td>
                                    </tr>
                                    <tr>
                                    	<td>套餐</td>
                                    	<td>普通文本</td>
                                        <td>套餐一</td>
                                        <td>否</td>
                                        <td>是</td>
                                        <td>3</td>
                                        <td>
                            				<a href="#" class="" data-toggle="modal" data-target=".modal-delete" style="margin:5px;">删除</a>
                                        </td>
                                    </tr>
                                    <tr>
                                    	<td>价格</td>
                                    	<td>普通文本</td>
                                        <td>无</td>
                                        <td>否</td>
                                        <td>否</td>
                                        <td>4</td>
                                        <td>
                            				<a href="#" class="" data-toggle="modal" data-target=".modal-delete" style="margin:5px;">删除</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div><!--end row-->
            <span class="tip red">*如字段类型为下拉菜单、单选按钮、多选按钮，需设置字段关联值，请用';'隔开</span>
            <a href="#" id="savefield" class="btn btn-default btn-primary  pull-right" data-toggle="modal" data-target="#createModal" style="margin-top:-10px;">创建并应用</a>
            <!--end page content-->
            <!--Start footer-->
            <footer class="footer" class="margin-tb-10">
                <span>Copyright &copy; </span>
            </footer>
            <!--end footer-->

        </section>
        <!--end main content-->



        <!--Common plugins-->
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/pace.min.js"></script>
        <script src="js/jasny-bootstrap.min.js"></script>
        <script src="js/jquery.slimscroll.min.js"></script>
        <script src="js/jquery.nanoscroller.min.js"></script>
        <script src="js/metismenu.min.js"></script>
        <script src="js/float-custom.js"></script>


        <!--page script-->
        <script src="js/jquery.datatables.min.js"></script>
        <script src="js/datatables.responsive.min.js"></script>
        <script src="js/jquery-ui.min.js"></script>
        <script src="js/jquery.ui.custom.js"></script>
        <script src="js/jayne.js"></script>        
        <script src="js/jstree.min.js"></script>
        <!--sweet alerts-->
        <script src="js/sweet-alert.min.js"></script>
        <script>
			var counter = 0;
        
            $(document).ready(function () {
            	
			    $('#datatable').DataTable({
			    	destroy:true,
			    	ordering: false ,
			        language: {
			            "sProcessing": "处理中...",
			            "sLengthMenu": "显示 _MENU_ 项结果",
			            "sZeroRecords": "没有匹配结果",
			            "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
			            "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
			            "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
			            "sInfoPostFix": "",
			            "sSearch": "搜索:",
			            "sUrl": "",
			            "sEmptyTable": "表中数据为空",
			            "sLoadingRecords": "载入中...",
			            "sInfoThousands": ",",
			            "oPaginate": {
			                "sFirst": "首页",
			                "sPrevious": "上页",
			                "sNext": "下页",
			                "sLast": "末页"
			            },
			            "oAria": {
			                "sSortAscending": ": 以升序排列此列",
			                "sSortDescending": ": 以降序排列此列"
			            }
			        }
			    });
				//add row
			    var table = $('#datatable').DataTable();
			    
			    $('#addRow').on( 'click', function () {
			        table.row.add( [
			        	'<input class="fieldname'+counter+'" style="width:100px">',
			        	'<select class="fieldtype'+counter+'" style="width:100px"><option value="普通文本">普通文本</option vlaue="电话文本"><option>电话文本</option><option vlaue="下拉菜单">下拉菜单</option><option vlaue="单选按钮">单选按钮</option><option vlaue="多选按钮">多选按钮</option><option vlaue="是否">是否</option><option vlaue="日期类型">日期类型</option></select>',
			        	'<input class="fieldrelated'+counter+'" style="width:100px">',
			        	'<select class="isrequired'+counter+'"><option value="1">是</option><option value="0">否</option></select>',
			        	'<select class="issearched'+counter+'"><option value="1">是</option><option value="0">否</option></select>',
			        	'<input class="sort'+counter+'" style="width:100px">',
			        	'<a href="#" class="sort'+counter+'" onclick="delete_r(this)" style="margin:5px;">删除</a>'
			        ] ).draw();
                    
                    $('.fieldname' + counter).focus()
                    $('.fieldname' + counter).click(function(){
                        this.focus()
                    })

			        counter++;
			    } );
			 
			    // Automatically add a first row of data
//			    $('#addRow').click();

                //checkbox
                $('#checkTree').jstree({
                    'core': {
                        'themes': {
                            'responsive': false
                        }
                    },
                    'types': {
                        'default': {
                            'icon': 'fa fa-folder'
                        },	
                        'file': {
                            'icon': 'fa fa-file'
                        }
                    },
                    'plugins': ['types', 'checkbox']
                });
            });
            
            
            function delete_r(othis){
            	swal({    
            		title: "确定删除吗？",    
            		type: "warning",   
            		showCancelButton: true,    
            		confirmButtonColor: "#DD6B55",   
            		confirmButtonText: "确定！",
            		cancelButtonText:'取消',
            		closeOnConfirm: false 
            	}, 
            	function(){   
            		swal(
            			"删除！", "该字段已经被删除。","success"
            		);
            		$(othis).parents("tr").css("display","none");
            	});
            	
            }
            
			function createhighsea(){
				var fieldname = new Array();
				var fieldtype = new Array();
				var fieldrelated = new Array();
				var isrequired = new Array();
				var issearched = new Array();
				var sort = new Array();
				var field = new Array();
				var errorflag = 0;
				for(var i = 0;i < counter;i++){
					var name = $('.fieldname'+i+'').val();
					var type = $('.fieldtype'+i+'').val();
					var related = $('.fieldrelated'+i+'').val();
					console.log(i);
					if(type=='下拉菜单'||type=='多选按钮'||type=='单选按钮'){
						if(related==''||(typeof related == 'undefined')){
                            errorflag=1;
                            break;
						}
					}
					fieldname.push($('.fieldname'+i+'').val());
					type = fieldtype.push($('.fieldtype'+i+'').val());
					fieldrelated.push($('.fieldrelated'+i+'').val());
					isrequired.push($('.isrequired'+i+'').val());
					issearched.push($('.issearched'+i+'').val());
					sort.push($('.sort'+i+'').val());
				}
				field.push(fieldname);
				field.push(fieldtype);
				field.push(fieldrelated);
				field.push(isrequired);
				field.push(issearched);
				field.push(sort);
				if(errorflag==1){
					//如果有错误就不传值
					
	            	swal({    
	            		title: ""+name+"字段为"+type+"需要填写字段关联值",    
	            		type: "warning",
	            		showCancelButton: true,    
	            		confirmButtonColor: "#DD6B55",   
	            		confirmButtonText: "确定删除！",
	            		cancelButtonText:'取消',
	            		closeOnConfirm: false 
	            	},function(){
	            		swal(
	            			"删除！", "该字段已经被删除。",
	            			"success"
	            		);
	            	})
				}else{
					//如果没有错误就传值制表
					alert(field);
				}
//				此处为获取所有字段值的方法，可作参考
			}
        </script>

    </body>
</html>
