<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>分机管理</title>
        
        <!-- Common plugins -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/simple-line-icons.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/pace.css" rel="stylesheet">
        <link href="css/jasny-bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/nanoscroller.css">
        <link rel="stylesheet" href="css/metismenu.min.css">
        <!-- dataTables -->
        <link href="css/jquery.datatables.min.css" rel="stylesheet" type="text/css">
        <link href="css/responsive.bootstrap.min.css" rel="stylesheet" type="text/css">
        <!-- Treeview css -->
        <link href="css/style_1.css" rel="stylesheet" type="text/css" />
        <!--sweetalert css-->
        <link href="css/sweet-alert.css" rel="stylesheet">
        <!--template css-->
	    <link href="css/jquery-ui.css" rel="stylesheet">
	
	    <link href="css/blue.css" rel="stylesheet">
	    <link href="css/style.css" rel="stylesheet">
	    <link href="css/jayne.css" rel="stylesheet">
	    <link href="css/vlstyle.css" rel="stylesheet">
	    <link rel="stylesheet" href="css/timeline.css">
        
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="js/html5shiv.min.js"></script>
          <script src="js/respond.min.js"></script>
        <![endif]-->
    </head>
    <body>

        <!--modal create start-->
        <div class="modal fade height-500" data-backdrop="static" id="createModal" tabindex="-1" role="dialog" aria-labelledby="createModal">
            <div class="modal-dialog " role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times-circle"></span></button>
                        <h3 class="modal-title" id="myModalLabel">新建分机</h3>
                    </div>
                    <div class="modal-body">
                        <div class="modal-form">
                            <form role="form">
                                <div class="form-group">
	                                <label>分机号</label>
	                                <span class="require-star">*</span>
                                    <input type="text" class="form-control inline width-80 float-right" name="number" required="">
                                </div>
                                <div class="form-group">
	                                <label>呼叫类型</label>
	                                <select name="call_type" class="form-control inline width-80 float-right" >
	                                	<option</option>
	                                	<option>friend</option>
	                                </select>
                                </div>
                                <div class="form-group">
	                                <label>密码</label>
	                                <span class="require-star">*</span>
                                    <input type="text" class="form-control  inline width-80 float-right" name="password" required="">
                                </div>
                                <div class="form-group">
	                                <label>端口</label>
	                                <span class="require-star">*</span>
                                    <input type="text" class="form-control  inline width-80 float-right" name="port" required="">
                                </div>
                                <div class="form-group">
	                                <label>注册地址</label>
                                    <input type="text" class="form-control  inline width-80 float-right" name="address" >
                                </div>
                                <div class="form-group">
	                                <label>注册类型</label>
	                                <select class="form-control  inline width-80 float-right" name="register_type">
	                                	<option>dynamic</option>
	                                	<option>ip地址</option>
	                                </select>
                                </div>
                                <div class="form-group">
	                                <label>dtmf类型</label>
                                    <input type="text" class="form-control inline width-80 float-right" name="dtmf_type">
                                </div>
                                <div class="form-group">
	                                <label>上下文</label>
                                    <input type="text" class="form-control inline width-80 float-right" name="context">
                                </div>
                                <div class="form-group">
	                                <label>同时呼叫数</label>
                                    <input type="text" class="form-control inline width-80 float-right" name="sync_call">
                                </div>
                                <div class="form-group">
	                                <label>支持nat</label>
	                                <select class="form-control inline width-80 float-right" name="support_nat">
	                                	<option>是</option>
	                                	<option>否</option>
	                                </select>
                                </div>
                                <div class="clearfix">
                                    <button type="submit" class="btn  btn-primary pull-right" onclick="add_tab()">创建</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--modal create end-->
        <!--modal update start-->
        <div class="modal fade" data-backdrop="static" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times-circle"></span></button>
                        <h3 class="modal-title" id="myModalLabel">修改分机</h3>
                    </div>
                    <div class="modal-body">
                        <div class="modal-form">
                            <form role="form">
                                <div class="form-group">
	                                <label>分机号</label>
	                                <span class="require-star">*</span>
                                    <input type="text" class="form-control inline width-80 float-right" name="al_number" required="">
                                </div>
                                <div class="form-group">
	                                <label>呼叫类型</label>
	                                <select name="al_call_type" class="form-control inline width-80 float-right" >
	                                	<option></option>
	                                	<option>friend</option>
	                                </select>
                                </div>
                                <div class="form-group">
	                                <label>密码</label>
	                                <span class="require-star">*</span>
                                    <input type="text" class="form-control  inline width-80 float-right" name="al_password" required="">
                                </div>
                                <div class="form-group">
	                                <label>端口</label>
	                                <span class="require-star">*</span>
                                    <input type="text" class="form-control  inline width-80 float-right" name="al_port" required="">
                                </div>
                                <div class="form-group">
	                                <label>注册地址</label>
                                    <input type="text" class="form-control  inline width-80 float-right" name="al_address" >
                                </div>
                                <div class="form-group">
	                                <label>注册类型</label>
	                                <select class="form-control  inline width-80 float-right" name="al_register_type">
	                                	<option>dynamic</option>
	                                	<option>ip地址</option>
	                                </select>
                                </div>
                                <div class="form-group">
	                                <label>dtmf类型</label>
                                    <input type="text" class="form-control inline width-80 float-right" name="al_dtmf_type">
                                </div>
                                <div class="form-group">
	                                <label>上下文</label>
                                    <input type="text" class="form-control inline width-80 float-right" name="al_context">
                                </div>
                                <div class="form-group">
	                                <label>同时呼叫数</label>
                                    <input type="text" class="form-control inline width-80 float-right" name="al_sync_call">
                                </div>
                                <div class="form-group">
	                                <label>支持nat</label>
	                                <select class="form-control inline width-80 float-right" name="al_support_nat">
	                                	<option>是</option>
	                                	<option>否</option>
	                                </select>
                                </div>
                                <div class="clearfix">
                                    <button type="submit" class="btn  btn-primary pull-right" onclick="alter_tab()">创建</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--modal update end-->

        <!--main content start-->
        <section class="main-content">

            <!--page header start-->
            <div class="page-header">
                <div class="row">
                    <div class="col-sm-6 flex-align-center">
                        <h4 class="inline">分机管理</h4>
                    </div>
                    <div class="col-sm-6 text-right">
                        <ol class="breadcrumb">
                            <li><a href="javascript: void(0);"><i class="fa fa-home"></i></a></li>
                            <li>话务设置</li>
                            <li>分机管理</li>
                        </ol>
                    </div>
                </div>
            </div>
            <!--page header end-->

	        <!--page filter start-->
	        <div class="row">
	            <div class="col-md-12">
	                <div class="panel panel-default collapsed">
	                    <div class="panel-heading">
	                        <p class="inline">查询条件</p>
                        	<a class="vl-a" id="resetBtn">重置查询条件</a>
	                    </div>
	                    <div class="panel-body">
	                        <div class="row">
	                            <div class="col-sm-3">
	                                <fieldset class="jquery-Ui-fieldset">
	                                    <label>分机号</label>
	                                    <input class="input-150p black" type="" name="number" id="number" value="" />
	                                </fieldset>
	                            </div>
	                            
	                            <div class="col-sm-3">
	                                <fieldset class="jquery-Ui-fieldset">
	                                	<label>上下文(流程块)</label>
	                                    <input class="input-150p black" type="" name="context" id="context" value="" />
	                                </fieldset>
	                            </div>
	                        </div>
	                        <a href="javascript: void(0);" class="btn btn-primary inline float-right" onclick="search_tab()">开始查询</a>
	                    </div>
	                    
	                </div>
	            </div>
	        </div>
	        <!--page filter end-->
        
        
            <!--start page content-->

            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default collapsed">
                    <div class="panel-heading">
                        <div class="buttons">
                            <a id="selectAllBtn" class="btn btn-primary btn-border">全选</a>
                            <a href="javascript: void(0);" class="btn btn-primary" data-toggle="modal" data-target="#createModal" >新增</a>
                            <a href="javascript: void(0);" class="btn btn-teal" data-toggle="modal" data-target="#updateModal" >修改</a>
                            <a href="javascript: void(0);" class="btn btn-danger" onclick="delete_r()">删除</a>
                        </div>
                    </div>
                        <div class="panel-body">
                            <table id="datatable" class="table table-striped dt-responsive nowrap">
                                <thead>
                                    <tr>
                                        <th>分机号</th>
                                        <th>呼叫类型</th>
                                        <th>密码</th>
                                        <th>端口</th>
                                        <th>注册地址</th>
                                        <th>注册类型</th>
                                        <th>dtmf类型</th>
                                        <th>上下文</th>
                                        <th>同时呼叫数</th>
                                        <th>支持nat</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                    	<td>100000</td>
                                    	<td>friend</td>
                                        <td>1111</td>
                                        <td>0</td>
                                        <td>192.168.1.21</td>
                                        <td>dynamic</td>
                                        <td>rfc2833</td>
                                        <td>haier</td>
                                        <td>2</td>
                                        <td></td>
                                        <td>
                            				<a href="#" data-toggle="modal" data-target="#updateModal" style="margin:5px;">修改</a>
                            				<a href="#" onclick="delete_r(this)" style="margin:5px;">删除</a>
                                        </td>
                                    </tr>
                                    <tr>
                                    	<td>100001</td>
                                    	<td>friend</td>
                                        <td>1111</td>
                                        <td>0</td>
                                        <td>192.168.1.2</td>
                                        <td>dynamic</td>
                                        <td>rfc2833</td>
                                        <td>haier</td>
                                        <td>2</td>
                                        <td></td>
                                        <td>
                            				<a href="#" data-toggle="modal" data-target="#updateModal" style="margin:5px;">修改</a>
                            				<a href="#" onclick="delete_r(this)" style="margin:5px;">删除</a>
                                        </td>
                                    </tr>
                                    <tr>
                                    	<td>100002</td>
                                    	<td>friend</td>
                                        <td>1111</td>
                                        <td>0</td>
                                        <td>192.168.1.21</td>
                                        <td>dynamic</td>
                                        <td>rfc2833</td>
                                        <td>haier</td>
                                        <td>2</td>
                                        <td></td>
                                        <td>
                            				<a href="#" data-toggle="modal" data-target="#updateModal" style="margin:5px;">修改</a>
                            				<a href="#" onclick="delete_r(this)" style="margin:5px;">删除</a>
                                        </td>
                                    </tr>
                                    <tr>
                                    	<td>100003</td>
                                    	<td>friend</td>
                                        <td>1111</td>
                                        <td>0</td>
                                        <td>192.168.1.21</td>
                                        <td>dynamic</td>
                                        <td>rfc2833</td>
                                        <td>haier</td>
                                        <td>2</td>
                                        <td></td>
                                        <td>
                            				<a href="#" data-toggle="modal" data-target="#updateModal" style="margin:5px;">修改</a>
                            				<a href="#" onclick="delete_r(this)" style="margin:5px;">删除</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div><!--end row-->
            
            <!--end page content-->


            <!--Start footer-->
            <footer class="footer">
                <span>Copyright &copy; </span>
            </footer>
            <!--end footer-->

        </section>
        <!--end main content-->
        
        <!--Common plugins-->
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/pace.min.js"></script>
        <script src="js/jasny-bootstrap.min.js"></script>
        <script src="js/jquery.slimscroll.min.js"></script>
        <script src="js/jquery.nanoscroller.min.js"></script>
        <script src="js/metismenu.min.js"></script>
        <script src="js/float-custom.js"></script>

        <!--page script-->
        <script src="js/jquery.datatables.min.js"></script>
        <script src="js/datatables.responsive.min.js"></script>
        <script src="js/jquery-ui.min.js"></script>
        <script src="js/jquery.ui.custom.js"></script>
        <script src="js/jayne.js"></script>        
        <!--sweet alerts-->
        <script src="js/sweet-alert.min.js"></script>
        <!--drawer alerts-->
    	<script src="js/drawer.js"></script>
	    <!-- iCheck for radio and checkboxes -->
	    <script src="js/icheck.min.js"></script>
        <script>

        var selected = [];//选择数组
        //筛选查询条件
		function search_tab(){
			var number = $('#number').val().trim();
			var context = $('#context').val().trim();
			alert(number);
			alert(context);
			//此处添加查询方法
		}
		
		//新增
		function add_tab(){
			var number = $("input[name='number']").val().trim();
			var call_type = $("select[name='call_type']").val();
			var password = $("input[name='password']").val().trim();
			var port = $("input[name='port']").val().trim();
			var address = $("input[name='address']").val().trim();
			var register_type = $("select[name='register_type']").val();
			var dtmf_type = $("input[name='dtmf_type']").val().trim();
			var context = $("input[name='context']").val().trim();
			var sync_call = $("input[name='sync_call']").val().trim();
			var support_nat = $("select[name='support_nat']").val();
			alert(number);
			alert(call_type);
			alert(password);
			alert(port);
			alert(address);
			alert(register_type);
			alert(dtmf_type);
			alert(context);
			alert(sync_call);
			alert(support_nat);
			//此处添加新增方法
		}
		
		//修改
		function alter_tab(){
			var al_number = $("input[name='al_number']").val().trim();
			var al_call_type = $("select[name='al_call_type']").val();
			var al_password = $("input[name='al_password']").val().trim();
			var al_port = $("input[name='al_port']").val().trim();
			var al_address = $("input[name='al_address']").val().trim();
			var al_register_type = $("select[name='al_register_type']").val();
			var al_dtmf_type = $("input[name='al_dtmf_type']").val().trim();
			var al_context = $("input[name='al_context']").val().trim();
			var al_sync_call = $("input[name='al_sync_call']").val().trim();
			var al_support_nat = $("select[name='al_support_nat']").val();
//			alert(al_number);
//			alert(al_call_type);
//			alert(al_password);
//			alert(al_port);
//			alert(al_address);
//			alert(al_register_type);
//			alert(al_dtmf_type);
//			alert(al_context);
//			alert(al_sync_call);
//			alert(al_support_nat);
			var count =0;
			console.log(selected);
			console.log(count);
			for(var i in selected){
				var row = selected[i]+1;
				var rows = $('#datatable tr').eq(row).find("td").eq(0).text();
				count++;
				console.log(rows);
			};
			if(count==0){
		        swal({
		            title:'修改至少选中一行',
		            timer:1000,
		            showConfirmButton:false
		        });
			}else if(count>1){
		        swal({
		            title:'修改不可选中多行',
		            timer:1000,
		            showConfirmButton:false
		        });
			}else{
				//此处添加修改方法
			}
			
		}
		
		//删除
		function delete_r() {
			var count =0;
			for(var i in selected){
				var row = selected[i]+1;
				var rows = $('#datatable tr').eq(row).find("td").eq(0).text();
				count++;
			};
			if(count==0){
		        swal({
		            title:'删除至少选中一行',
		            timer:1000,
		            showConfirmButton:false
		        });
			}else{
				swal({
					title: "确定删除吗？",
					type: "warning",
					showCancelButton: true,
					confirmButtonColor: "#DD6B55",
					confirmButtonText: "确定！",
					cancelButtonText: '取消',
					closeOnConfirm: false
				},
				function () {
					//此处添加删除方法,如果删除成功执行：
					swal(
						"删除！", "该分机已经被删除。", "success"
					);
					console.log(selected);
					for(var i in selected){
						var row = selected[i]+1;
						var rows = $('#datatable tr').eq(row).find("td").eq(0).text();
						count++;
						$('#datatable').find("tr").eq(row).css('display','none');
					};
					for(var i in selected){
						selected.splice(i);
					};
				});
			}

		}

		$(document).ready(function () {
			$('#datatable').dataTable();

			//重置全部选择
            $('#resetBtn').click(function () {
                resetFilter()
            })

            function resetFilter() {

                $('input[name="number"]').val('')
                $('input[name="context"]').val('')
            }
            
			// 选择当前行，排除对于操作列的click监听
			$('#datatable tbody').on('click', "tr", function () {

				var id = $(this).index();  // id 从server端获取

				var index = $.inArray(id, selected);

				if (index === -1) {
					selected.push(id);
				} else {
					selected.splice(index, 1);
				}

				$(this).toggleClass('selected');

				btnOnSelected(); // 监听是否全选，更改btn status

			});

			// 全选与取消全选
			$('#selectAllBtn').click(function () {

				// flag 也可以用server选中后的id list 判断，同时在单条选中所有后，更新button状态
				var flag = $('#selectAllBtn').text() == '全选' ? true : false
				flag ?
					$('#selectAllBtn').text('取消全选')
					: $('#selectAllBtn').text('全选')

				$('#datatable tbody tr').each(function (i) {
					flag ?
						$(this).addClass('selected')
						: $(this).removeClass('selected')
				})

			})

			function btnOnSelected() {
				if ($('tbody tr').not('.selected').length == 0) {
					$('#selectAllBtn').text('取消全选')
				} else {
					$('#selectAllBtn').text('全选')
				}
			}
			
			// radio添加class
			$('.i-checks').iCheck({
				checkboxClass: 'icheckbox_square-blue',
				radioClass: 'iradio_square-blue'
			});
			
		});


        </script>

    </body>
</html>
